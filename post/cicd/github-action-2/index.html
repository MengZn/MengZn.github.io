<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Github Action å¦³å„ä½ï¼Œæ³¨æ„ Heroku ï¼ - Meng Ze&#39;s Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="Github Action å¦³å„ä½ï¼Œæ³¨æ„ Heroku ï¼" />
<meta property="og:description" content="
     
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.jjmengze.website/post/cicd/github-action-2/" />
<meta property="article:published_time" content="2020-06-02T14:17:22+08:00" />
<meta property="article:modified_time" content="2020-06-02T14:17:22+08:00" />

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Meng Ze&#39;s Blog" rel="home">
				<div class="logo__title">Meng Ze&#39;s Blog</div>
				<div class="logo__tagline">Record my learning process</div>
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About Me</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Github Action å¦³å„ä½ï¼Œæ³¨æ„ Heroku ï¼</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2020-06-02T14:17:22&#43;08:00">2020-06-02</time></div></div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#ç”³è«‹-heroku-å¸³è™Ÿ">ç”³è«‹ Heroku å¸³è™Ÿ</a></li>
    <li><a href="#å®‰è£-heroku-cli">å®‰è£ Heroku CLI</a></li>
    <li><a href="#æ¸¬è©¦-heroku">æ¸¬è©¦ Heroku</a></li>
    <li><a href="#æ”¹åˆ°-github-action">æ”¹åˆ° Github Action</a></li>
    <li><a href="#çµæŸèª">çµæŸèª</a></li>
  </ul>
</nav>
	</div>
</div>
<div class="content post__content clearfix">
			<figure>
    <img src="/images/post/githubaction-heroku.png"/> 
</figure>

<p>å‰é¢æœ‰ä¸€ç¯‡æ–‡ç« ï¼Œåœ¨æè¿° Github Action åš CI/CD çš„å¥½è™•ï¼Œå°æ–¼ Github Action é‚„ä¸å¤ªäº†è§£çš„æœ‹å‹å¯ä»¥åƒè€ƒ<a href="https://blog.jjmengze.website/post/cicd/github-action-1/"> Github Action èµ·æ­¥èµ°ç¬¬ä¸€å¼</a>äº†è§£ä¸€ä¸‹æœ€åŸºç¤çš„æ±è¥¿æ€éº¼ç”¨å§ï½</p>
<p>åœ¨ CI/CD ç¸½æœ‰ä¸€å€‹éšæ®µæœƒéœ€è¦å•Šæˆ‘å€‘æ‡‰æ‡‰ç”¨æœå‹™éƒ¨ç½²åˆ° Server ä¸Šæä¾›å°æ‡‰çš„æœå‹™ï¼Œå°æ–¼åˆæœŸå¿«é€Ÿç™¼å±•çš„å…¬å¸ä¾†èªª Heroku æ˜¯ä¸€å€‹æ»¿å¥½ç”¨çš„å¹³å°ï¼Œå¯ä»¥ç›´æ¥æŠŠ source code push ä¸Šå»ï¼Œ Heroku æœƒæä¾›å…è²»å¸³æˆ¶æ¯å€‹æœˆ 450 å€‹å°æ™‚çš„ï¼Œé–‹é€šä¿¡ç”¨å¡ï¼Œé‚„æœƒé¡å¤–å¢åŠ  550 å€‹å°æ™‚çš„å…è²»æ™‚æ•¸ï¼Œæ­¤å¤– Heroku æœƒå¹«ä½ è¨­å®šç›¸é—œçš„ Url è®“å¤–éƒ¨å¯ä»¥è®€å–ä½ çš„æœå‹™ï¼Œé€™è®“é–‹ç™¼äººå“¡ä¸ç”¨æ“”å¿ƒ infrastructure çš„å•é¡Œï¼Œå¯ä»¥æ›´åŠ å°ˆæ³¨åœ¨ application çš„é–‹ç™¼ã€‚</p>
<p>é€™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ä¸€å€‹å°ç¯„ä¾‹ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ Github Action ä¸­åµŒå…¥ä¸€å€‹ Job è®“æœå‹™éƒ¨ç½²åˆ° Herokuä¸Šï½</p>
<h2 id="ç”³è«‹-heroku-å¸³è™Ÿ">ç”³è«‹ Heroku å¸³è™Ÿ</h2>
<p>é¦–å…ˆæˆ‘å€‘è¦å»ç”³è«‹ <a href="https://signup.heroku.com/">Heroku å¸³è™Ÿ </a>ï¼Œé€™é‚Šéå¸¸ç°¡å–®æŠŠä»–æ‰“ç±³å­—è™Ÿçš„æ¬„ä½å¡«ä¸€å¡«å¯«ä¸€å¯«å°±æ²’å•é¡Œäº†ï½</p>
<p><img src="https://i.imgur.com/ZpsF0cm.png" alt=""></p>
<hr>
<p>å®Œæˆé€™å€‹å®Œæˆé€™å€‹ç”³è«‹å¸³è™Ÿçš„æ­¥é©Ÿä¹‹å¾Œï¼Œæ¥è‘—é–‹ä¸€å€‹ Heroku çš„æ‡‰ç”¨ç¨‹å¼ï¼Œé€éä»‹é¢ä¸Šçš„ New çš„ Create new app å»ºç«‹ä¸€å€‹æ‡‰ç”¨ç¨‹å¼ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯App name åªèƒ½ç”¨å°å¯«çš„è‹±æ–‡ï¼Œè€Œä¸”æ˜¯æ²’æœ‰è¢«ä½¿ç”¨éçš„ï¼ŒåŸºæœ¬ä¸Šé€™æ¨£å°±å®Œæˆäº†è·Ÿåœ¨ Github ä¸Šå»ºç«‹ä¸€å€‹ Repository ä¸€æ¨£ç°¡å–®ã€‚
<img src="https://i.imgur.com/MQnROjS.png" alt=""></p>
<h2 id="å®‰è£-heroku-cli">å®‰è£ Heroku CLI</h2>
<p>å®‰è£ Heroku CLI é€™å€‹éƒ¨åˆ†ä¹Ÿç›¸ç•¶çš„ç°¡å–®å®‰è£éç¨‹å¯ä»¥åƒè€ƒ<a href="https://devcenter.heroku.com/articles/heroku-cli">å®˜æ–¹çš„æ•™å­¸</a>ï¼Œæˆ‘é€™é‚Šä»¥ MACOS ä½œç‚ºç¤ºç¯„æœ‰å…¶ä»–ä½œæ¥­ç³»çµ±éœ€æ±‚çš„è«‹éº»ç…©è«‹åƒè€ƒå®˜ç¶²å›‰ï½</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">brew tap heroku/brew &amp;&amp; brew install heroku

Updating Homebrew...
==&gt; Auto-updated Homebrew!
Updated 3 taps (homebrew/core, homebrew/cask and homebrew/cask-fonts).
...
...
==&gt; Installing dependencies for heroku/brew/heroku: heroku/brew/heroku-node
==&gt; Installing heroku/brew/heroku dependency: heroku/brew/heroku-node
ğŸº  /usr/local/Cellar/heroku-node/12.16.2: 3 files, 42.2MB, built in 3 seconds
==&gt; Installing heroku/brew/heroku
...
</code></pre></div><p>æ¸¬è©¦ä¸€ä¸‹ Heroku CLI æ˜¯ä¸æ˜¯å·²ç¶“è£å¥½äº†</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">heroku

CLI to interact with Heroku

VERSION
  heroku/7.41.1 darwin-x64 node-v12.16.2

USAGE
  $ heroku [COMMAND]

COMMANDS
  access          manage user access to apps
  addons          tools and services <span style="color:#fb660a;font-weight:bold">for</span> developing, extending, and operating
                  your app
  apps            manage apps on Heroku
  auth            check 2fa status
  authorizations  OAuth authorizations
  autocomplete    display autocomplete installation instructions
  buildpacks      scripts used to compile apps
  certs           a topic <span style="color:#fb660a;font-weight:bold">for</span> the ssl plugin
  ci              run an application test suite on Heroku
  clients         OAuth clients on the platform
  config          environment variables of apps
  container       Use containers to build and deploy Heroku apps
  domains         custom domains <span style="color:#fb660a;font-weight:bold">for</span> apps
  drains          forward logs to syslog or HTTPS
  features        add/remove app features
  git             manage local git repository <span style="color:#fb660a;font-weight:bold">for</span> app
  help            display help <span style="color:#fb660a;font-weight:bold">for</span> heroku
  keys            add/remove account ssh keys
  labs            add/remove experimental features
  local           run Heroku app locally
  logs            display recent log output
  maintenance     enable/disable access to app
  members         manage organization members
  notifications   display notifications
  orgs            manage organizations
  pg              manage postgresql databases
  pipelines       manage pipelines
  plugins         list installed plugins
  ps              Client tools <span style="color:#fb660a;font-weight:bold">for</span> Heroku Exec
  psql            open a psql shell to the database
  redis           manage heroku redis instances
  regions         list available regions <span style="color:#fb660a;font-weight:bold">for</span> deployment
  releases        display the releases <span style="color:#fb660a;font-weight:bold">for</span> an app
  reviewapps      manage reviewapps in pipelines
  run             run a one-off process inside a Heroku dyno
  sessions        OAuth sessions
  spaces          manage heroku private spaces
  status          status of the Heroku platform
  teams           manage teams
  update          update the Heroku CLI
  webhooks        list webhooks on an app
</code></pre></div><h2 id="æ¸¬è©¦-heroku">æ¸¬è©¦ Heroku</h2>
<p>é€™é‚Šä»¥ä¸€å€‹ç°¡å–®çš„ go server ä½œç‚ºç¯„ä¾‹ï¼Œç¨‹å¼ç¢¼å¦‚ä¸‹æ‰€ç¤ºã€‚ç•¶æˆ‘å€‘å°é€™å€‹ server ç™¼èµ·è«‹æ±‚ä»–æœƒå›æ‡‰ä½  ç¾åœ¨ server æ˜¯ä½¿ç”¨å“ªä¸€å€‹ port è·Ÿä½ åšæºé€šã€‚</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#fb660a;font-weight:bold">package</span> main

<span style="color:#fb660a;font-weight:bold">import</span> (
	<span style="color:#0086d2">&#34;net/http&#34;</span>
	<span style="color:#0086d2">&#34;os&#34;</span>
)

<span style="color:#fb660a;font-weight:bold">func</span> <span style="color:#ff0086;font-weight:bold">main</span>() {
	http.<span style="color:#ff0086;font-weight:bold">HandleFunc</span>(<span style="color:#0086d2">&#34;/&#34;</span>, <span style="color:#fb660a;font-weight:bold">func</span>(w http.ResponseWriter, r *http.Request) {
		w.<span style="color:#ff0086;font-weight:bold">WriteHeader</span>(http.StatusOK)
		w.<span style="color:#ff0086;font-weight:bold">Header</span>().<span style="color:#ff0086;font-weight:bold">Set</span>(<span style="color:#0086d2">&#34;Content-Type&#34;</span>, <span style="color:#0086d2">&#34;text/html; charset=utf-8&#34;</span>)
                p:=os.<span style="color:#ff0086;font-weight:bold">Getenv</span>(<span style="color:#0086d2">&#34;PORT&#34;</span>)
		w.<span style="color:#ff0086;font-weight:bold">Write</span>([]byte(p))
	})

	http.<span style="color:#ff0086;font-weight:bold">ListenAndServe</span>(<span style="color:#0086d2">&#34;0.0.0.0:&#34;</span>+os.<span style="color:#ff0086;font-weight:bold">Getenv</span>(<span style="color:#0086d2">&#34;PORT&#34;</span>), <span style="color:#fb660a;font-weight:bold">nil</span>)
}
</code></pre></div><p>é€é Heroku CLI ç™»å…¥ Heroku ï¼Œé©—è­‰å®Œèº«ä»½å¾Œï¼Œå°±èƒ½å¤ é€é Git æŠŠsource code æ¨åˆ° Heroku ä¸Šå›‰ï½</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">heroku login

heroku: Press any key to open up the browser to login or q to exit:
Opening browser to https://cli-auth.heroku.com/auth/cli/browser/5e83cd9d-51cc-4676-b0be-d240a1f5c480
Logging in... <span style="color:#fb660a;font-weight:bold">done</span>
...
</code></pre></div><p>æ¥è‘—è¨­å®š heroku git æŠŠgit remote url è¨­å®šå¥½</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">heroku git:remote -a example-githubaction
set git remote heroku to https://git.heroku.com/example-githubaction.git
</code></pre></div><p>å…ˆçœ‹çœ‹ Heroku æœ‰æ²’æœ‰åŠ åˆ° git remote url</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git remote -v
heroku	https://git.heroku.com/example-githubaction.git (fetch)
heroku	https://git.heroku.com/example-githubaction.git (push)
origin	https://github.com/jjmengze/heroku-go.git (fetch)
origin	https://github.com/jjmengze/heroku-go.git (push)
</code></pre></div><p>æœ€å¾Œé€égit push æŒ‡ä»¤å°‡source codeä¸Šå‚³åˆ° Heroku</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git push heroku master
Enumerating objects: 10, <span style="color:#fb660a;font-weight:bold">done</span>.
Counting objects: 100% (10/10), <span style="color:#fb660a;font-weight:bold">done</span>.
Delta compression using up to <span style="color:#0086f7;font-weight:bold">8</span> threads
Compressing objects: 100% (6/6), <span style="color:#fb660a;font-weight:bold">done</span>.
Writing objects: 100% (10/10), 1.25 KiB | 640.00 KiB/s, <span style="color:#fb660a;font-weight:bold">done</span>.
Total <span style="color:#0086f7;font-weight:bold">10</span> (delta 0), reused <span style="color:#0086f7;font-weight:bold">0</span> (delta 0)
remote: Compressing source files... <span style="color:#fb660a;font-weight:bold">done</span>.
remote: Building source:
remote:
remote: -----&gt; Go app detected
...
...
remote: -----&gt; Launching...
remote:        Released v3
remote:        https://example-githubaction.herokuapp.com/ deployed to Heroku
remote:
remote: Verifying deploy... <span style="color:#fb660a;font-weight:bold">done</span>.
To https://git.heroku.com/example-githubaction.git
 * [new branch]      master -&gt; master
</code></pre></div><p>å®Œæˆå¾Œå›åˆ°ä¹‹å‰åœ¨ Heroku ä¸Šå»ºç«‹çš„æ‡‰ç”¨ç¨‹å¼ï¼Œä¸¦ä¸”åœ¨ä¸Šæ–¹çš„é¸é …é»é¸ Settings
<img src="https://i.imgur.com/LVfsNar.png" alt="">
æœ€ä¸‹æ–¹ Heroku æœƒå‘Šè¨´ä½ é€™å€‹æ‡‰ç”¨ç¨‹å¼çš„ Domain ï¼Œä¸€èˆ¬ä¾†èªªæœƒæ˜¯ <code>https://&lt;appname&gt;.herokuapp.com/</code>ï¼Œæ‰€ä»¥ä»¥æœ¬ç¯‡çš„ä¾‹å­æœƒæ˜¯ <code>https://example-githubaction.herokuapp.com/</code> ã€‚åˆ°é é¢ä¸‹æ–¹æª¢æŸ¥ä¸€ä¸‹ Domainæ˜¯ä¸æ˜¯é€™å€‹ï½</p>
<p><img src="https://i.imgur.com/Lc3xIqi.png" alt=""></p>
<p>å¯ä»¥è«‹æ±‚ä¸€ä¸‹é€™å€‹ domain çœ‹çœ‹å¾—åˆ°çš„çµæœæ˜¯ä»€éº¼</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://example-githubaction.herokuapp.com/
<span style="color:#0086f7;font-weight:bold">59048</span>
</code></pre></div><p>è¡¨ç¤ºç›®å‰ server æ˜¯ç”¨ 59048 çš„ port è·Ÿä½ é€²è¡Œæºé€šï¼Œé€™é‚Šæˆ‘å°±æƒ³åˆ°å£å£çš„äº‹æƒ…æƒ¹ï¼Œé‚£æˆ‘èƒ½ä¸èƒ½ç”¨ Heroku æä¾›çš„æœå‹™ åœ¨è£¡é¢å•Ÿç”¨ä¸€å€‹ sshd ï¼Œå¦é¡ VM çš„æ¦‚å¿µxD (ä¸éé‚£åˆæ˜¯å¦å¤–ä¸€å€‹æ•…äº‹äº†)</p>
<h2 id="æ”¹åˆ°-github-action">æ”¹åˆ° Github Action</h2>
<p>æ—¢ç„¶ç´”æ‰‹å‹• ( manually setup ) å¯ä»¥å®Œæˆï¼Œé‚£æˆ‘ç›¸ä¿¡é€é CI/CD è‡ªå‹•åŒ–æ©Ÿåˆ¶ä¹Ÿå¯ä»¥å®Œæˆï¼</p>
<p>é€™é‚Šå¯ä»¥åˆ° Github Marketplace å»æ‰¾æ‰¾æœ‰æ²’æœ‰äººåšç›¸é—œçš„ Action ï¼Œå¥½çš„å·¥ç¨‹å¸«ç¬¬ä¸€æ­¥è¦å­¸æœƒæ€éº¼æ‰¾è³‡æ–™ xD</p>
<p>é€™é‚Šå¯ä»¥çœ‹åˆ°æœ‰ä¸å°‘ Action éƒ½æœ‰åœ¨åš HeroKu ç›¸é—œçš„éƒ¨ç½²ï¼Œå¯ä»¥åƒè€ƒäººå®¶æ€éº¼å¯¦ä½œåœ¨è©¦è©¦çœ‹èƒ½ä¸èƒ½ç”¨æ›´ç°¡å–®çš„æ–¹æ³•åšä¸€å€‹å‡ºä¾†ã€‚</p>
<p><img src="https://i.imgur.com/ZZos9Q7.png" alt=""></p>
<p>é€™é‚Šæˆ‘ç›´æ¥çµ¦å‡ºä¸€å€‹æ–¹æ¡ˆæ‰€æœ‰ç¨‹å¼ç¢¼èˆ‡å…§å®¹å¯ä»¥åƒè€ƒæˆ‘åœ¨ Github çš„<a href="https://github.com/jjmengze/heroku-go">ç¯„ä¾‹å°ˆæ¡ˆ</a>ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥è©¦è©¦çœ‹ï¼ŒåŸºæœ¬ä¸Šçš„æ€è·¯æ˜¯é€é Heroku æä¾›çš„ container æœå‹™ç›´æ¥æŠŠ source code åŒ…æˆ container ä¸¦ä¸”ä¸Šå‚³åˆ° heroku image registry ä¸Šï¼Œç›¸é—œçš„éƒ¨ç½²ä»¥åŠè©³ç´°å‹•ä½œå¯ä»¥åƒè€ƒ<a href="https://devcenter.heroku.com/articles/container-registry-and-runtime">å®˜æ–¹çš„ç¯„ä¾‹</a></p>
<p>é€™é‚Šæˆ‘ç›´æ¥ä¸Šgithub action æ•´åˆHeroku container image å¾Œçš„ ci yamlçµ¦å¤§å®¶åƒè€ƒï¼Œå¤§å®¶ä¹Ÿå¯ä»¥ä¾ç…§å€‹åšè®ŠåŒ–åšæˆè‡ªå·±æƒ³è¦çš„æ¨£å­ã€‚</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#888">  </span><span style="color:#fb660a;font-weight:bold">push</span>:<span style="color:#888">
</span><span style="color:#888">    </span><span style="color:#fb660a;font-weight:bold">name</span>:<span style="color:#888"> </span>Push<span style="color:#888">
</span><span style="color:#888">    </span><span style="color:#fb660a;font-weight:bold">runs-on</span>:<span style="color:#888"> </span>ubuntu-latest<span style="color:#888">
</span><span style="color:#888">    </span><span style="color:#fb660a;font-weight:bold">steps</span>:<span style="color:#888">
</span><span style="color:#888">    </span>- <span style="color:#fb660a;font-weight:bold">name</span>:<span style="color:#888"> </span>Check<span style="color:#888"> </span>out<span style="color:#888"> </span>code<span style="color:#888"> </span>into<span style="color:#888"> </span>the<span style="color:#888"> </span>Go<span style="color:#888"> </span>module<span style="color:#888"> </span>directory<span style="color:#888">
</span><span style="color:#888">      </span><span style="color:#fb660a;font-weight:bold">uses</span>:<span style="color:#888"> </span>actions/checkout@v2<span style="color:#888">
</span><span style="color:#888">    </span>- <span style="color:#fb660a;font-weight:bold">name</span>:<span style="color:#888"> </span>Login<span style="color:#888"> </span>to<span style="color:#888"> </span>Heroku<span style="color:#888"> </span>Container<span style="color:#888"> </span>registry<span style="color:#888">
</span><span style="color:#888">      </span><span style="color:#fb660a;font-weight:bold">env</span>:<span style="color:#888"> 
</span><span style="color:#888">        </span><span style="color:#fb660a;font-weight:bold">HEROKU_API_KEY</span>:<span style="color:#888"> </span>${{<span style="color:#888"> </span>secrets.HEROKU_API_KEY<span style="color:#888"> </span>}}<span style="color:#888">
</span><span style="color:#888">      </span><span style="color:#fb660a;font-weight:bold">run</span>:<span style="color:#888"> </span>heroku<span style="color:#888"> </span>container:login<span style="color:#888"> 
</span><span style="color:#888">    </span>- <span style="color:#fb660a;font-weight:bold">name</span>:<span style="color:#888"> </span>Build<span style="color:#888"> </span>and<span style="color:#888"> </span>push<span style="color:#888">
</span><span style="color:#888">      </span><span style="color:#fb660a;font-weight:bold">env</span>:<span style="color:#888">
</span><span style="color:#888">        </span><span style="color:#fb660a;font-weight:bold">HEROKU_API_KEY</span>:<span style="color:#888"> </span>${{<span style="color:#888"> </span>secrets.HEROKU_API_KEY<span style="color:#888"> </span>}}<span style="color:#888">
</span><span style="color:#888">      </span><span style="color:#fb660a;font-weight:bold">run</span>:<span style="color:#888"> </span>heroku<span style="color:#888"> </span>container:push<span style="color:#888"> </span>-a<span style="color:#888"> </span>${{<span style="color:#888"> </span>env.APP_NAME<span style="color:#888"> </span>}}<span style="color:#888">  </span>web<span style="color:#888">
</span><span style="color:#888">    </span>- <span style="color:#fb660a;font-weight:bold">name</span>:<span style="color:#888"> </span>Release<span style="color:#888">
</span><span style="color:#888">      </span><span style="color:#fb660a;font-weight:bold">env</span>:<span style="color:#888">
</span><span style="color:#888">        </span><span style="color:#fb660a;font-weight:bold">HEROKU_API_KEY</span>:<span style="color:#888"> </span>${{<span style="color:#888"> </span>secrets.HEROKU_API_KEY<span style="color:#888"> </span>}}<span style="color:#888">
</span><span style="color:#888">      </span><span style="color:#fb660a;font-weight:bold">run</span>:<span style="color:#888"> </span>heroku<span style="color:#888"> </span>container:release<span style="color:#888"> </span>-a<span style="color:#888"> </span>${{<span style="color:#888"> </span>env.APP_NAME<span style="color:#888"> </span>}}<span style="color:#888">  </span>web<span style="color:#888">
</span></code></pre></div><p>å…¶ä¸­å¯ä»¥çœ‹åˆ° push é€™å€‹ stage åŸ·è¡Œäº†å››å€‹ steps ï¼Œæ¯”è¼ƒè¦é—œæ³¨çš„æ˜¯å¾Œé¢é‚£ä¸‰å€‹ã€‚åˆ†åˆ¥æ˜¯åŸ·è¡Œ</p>
<ul>
<li>heroku container:login</li>
<li>heroku container:push -a ${{ env.APP_NAME }}  web</li>
<li>heroku container:release -a ${{ env.APP_NAME }}  web</li>
</ul>
<p>é€™ä¸‰éƒ¨åˆ†åˆ¥å°æ‡‰çš„æ˜¯</p>
<ul>
<li>ç™»å…¥ heroku</li>
<li>æ§‹å»º Container image ä¸¦å°‡å…¶æ¨é€åˆ° Heroku Container Registry</li>
<li>å°‡ Heroku Container Registry ä¸Šçš„ Container image é€²è¡Œéƒ¨ç½²èˆ‡ç™¼ä½ˆ</li>
</ul>
<p>HEROKU_API_KEY ä»¥åŠ APP_NAME éƒ½å¯ä»¥åœ¨ Github çš„ CI/CD æœå‹™ç›´æ¥åšç’°å¢ƒè®Šæ•¸çš„ç·¨è¼¯ï¼Œé€éé€™ä¸€ç¨®æ–¹å¼æˆ‘å€‘å¯ä»¥å¾ˆç°¡å–®çš„æŠŠæœå‹™éƒ¨ç½²åˆ°Herokuä¸Šé¢ã€‚é–‹ç™¼äººå“¡å¯ä»¥å¿«é€Ÿçš„éƒ¨ç½²èˆ‡æ¸¬è©¦è‡ªå·±çš„æœå‹™ï½ CI/CD å¸¶ä¾†çš„å¥½è™•å¤šå¤šï¼Œå¸Œæœ›å¤§å®¶å¯ä»¥å¤šå¤šå˜—è©¦ã€‚</p>
<h2 id="çµæŸèª">çµæŸèª</h2>
<p>ä»Šå¤©éå¸¸ç°¡å–®çš„ä»‹ç´¹äº† Heroku èˆ‡ Github Action çš„æ•´åˆçš„åŠŸèƒ½ï¼Œä»¥åŠæ€éº¼å¿«é€Ÿå¾—ä½¿ç”¨ Heroku çµ¦å¤–éƒ¨åšå­˜å–ï¼Œä¸‹æ¬¡æœ‰æ©Ÿæœƒå†ä¾†ä»‹ç´¹ä»–è·Ÿdockeræ€éº¼æ•´åˆä»¥åŠæ€éº¼æ’°å¯«è‡ªå·±çš„ action è²¢ç»çµ¦ Github Action Marketplace è®“å¤§å®¶ä¾†ä½¿ç”¨ã€‚</p>
		</div>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Meng Ze avatar" src="/img/apple.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Meng Ze</span>
	</div>
	<div class="authorbox__description">
		Meng å°ˆæ³¨æ–¼é›²ç«¯ä¸–ç•Œçš„è€•è€˜è€…ï¼Œå–œæ­¡æ½›æ°´å¥èº«ç­‰ä¼‘é–’é‹å‹•ã€‚
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/post/kubernetes/private-image/" rel="prev">
			<span class="post-nav__caption">Â«&thinsp;Previous</span>
			<p class="post-nav__post-title">å…¬æœ‰é›²kubernetes pull unssl container image registry</p>
		</a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/post/ca/ca-one-way-ssl/" rel="next">
			<span class="post-nav__caption">Next&thinsp;Â»</span>
			<p class="post-nav__post-title">CA å‹•æ‰‹ç©</p>
		</a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "meng-ze" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Meng Ze&#39;s Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>