<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>簡單理解 Operator Lifecycle Manager - 2 (OLM) - Meng Ze&#39;s Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="簡單理解 Operator Lifecycle Manager - 2 (OLM)" />
<meta property="og:description" content="
     
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.jjmengze.website/post/ocp/operator-lifecycle-manager-2/" />
<meta property="article:published_time" content="2020-07-13T16:06:29+08:00" />
<meta property="article:modified_time" content="2020-07-13T16:06:29+08:00" />

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Meng Ze&#39;s Blog" rel="home">
				<div class="logo__title">Meng Ze&#39;s Blog</div>
				<div class="logo__tagline">Record my learning process</div>
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About Me</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">簡單理解 Operator Lifecycle Manager - 2 (OLM)</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2020-07-13T16:06:29&#43;08:00">2020-07-13</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/openshift/" rel="category">openshift</a>
	</span>
</div></div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#gui-操作">GUI 操作</a></li>
    <li><a href="#crd---operatorgroup">CRD - OperatorGroup</a></li>
    <li><a href="#crd---subscription">CRD - Subscription</a></li>
    <li><a href="#crd---installplan">CRD - Installplan</a></li>
    <li><a href="#crd---clusterserviceversion-csv">CRD - ClusterServiceVersion (CSV)</a></li>
    <li><a href="#結語">結語</a></li>
  </ul>
</nav>
	</div>
</div>
<div class="content post__content clearfix">
			<figure>
    <img src="/images/theme/olm-2.png"/> 
</figure>

<h1 id="簡單理解-operator-lifecycle-manager---2-olm">簡單理解 Operator Lifecycle Manager - 2 (OLM)</h1>
<p>OpenShift Container Platform 4，使用了大量的 <code>Operator</code> 管理 Kubernetes Resource ，或許這跟 redhat 的推行Kubernetes政策有關吧 xD。</p>
<p>但是這邊會延伸出蛋生雞雞生蛋的問題，那 <code>Operator</code> 要怎麼被管理呢？</p>
<p>redhat 給出了一個解答那就是 <code>Operator Lifecycle Manager</code> 又稱 <code>OLM</code>，使用者透過 <code>Declarative</code> 的方式告訴 <code>OLM</code> ，要建立什麼樣子的 <code>Operator</code> 。</p>
<p>:::info
本篇文章的重點在於 OLM，是用來管理 Operator。
朝著這方面去思考一且都會變得比較簡單！
:::</p>
<p>接續著上篇提到觀念本篇會示範如何在 cluster 中從 <code>CatalogSources</code> 下載一個 <code>PackageManifest</code> 並且安裝到環境。</p>
<h2 id="gui-操作">GUI 操作</h2>
<p><img src="https://i.imgur.com/A3U6VhB.png" alt=""></p>
<p>可以從圖片看到在 administration 模式底下可以從左邊選取 Operators ，裡面有兩個分頁分別是 OperatorHub 以及 install Operators。</p>
<p>我們可以透過 OCP Portal 直接下載想要的 Operator ，可以在右手邊看到有許多種類提供我們做選擇。</p>
<p>這個部份留給有興趣的朋友，今天著重於 CLI 的操作。</p>
<h2 id="crd---operatorgroup">CRD - OperatorGroup</h2>
<p>從 <code>CatalogSources</code> 下載一個 <code>PackageManifest</code> 之前我們要先建立一個<code>project</code>(namespaces)，讓操作都在這個 <code>project</code> 下。</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc new-project playolm
</code></pre></div><p>建立完成 project 後我們還需要建立一個 <code>OperatorGroup</code> 確認之後安裝的 <code>operator</code> 只有操作這個 namespaces 的權限，對於 <code>OperatorGroup</code> 想要多瞭解一下可以參考<a href="https://operator-framework.github.io/olm-book/docs/operator-scoping.html">olm book</a>。</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat <span style="color:#0086d2">&lt;&lt;EOF | oc apply -f -
</span><span style="color:#0086d2">apiVersion: operators.coreos.com/v1
</span><span style="color:#0086d2">kind: OperatorGroup
</span><span style="color:#0086d2">metadata:
</span><span style="color:#0086d2">  name: prometheus-operatorgroup
</span><span style="color:#0086d2">  namespace: playolm
</span><span style="color:#0086d2">spec:
</span><span style="color:#0086d2">  targetNamespaces:
</span><span style="color:#0086d2">    - playolm
</span><span style="color:#0086d2">EOF</span>
operatorgroup.operators.coreos.com/prometheus-operatorgroup created
</code></pre></div><p>透過指令確認一下剛剛部署上去的 <code>operatorgroup</code></p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc get operatorgroup prometheus-operatorgroup
NAME                   AGE
prometheus-operatorgroup   114s
</code></pre></div><h2 id="crd---subscription">CRD - Subscription</h2>
<p>剛剛設定好<code>operatorgroup</code>，現在要到 <code>CatalogSources</code> 下載一個 <code>PackageManifest</code> 還記得上一個章節有拿一個 community-operators 的 prometheus-exporter-operator yaml 簡單的看一下裡面的內容嗎？</p>
<p>這邊在執行一次看一下裡面的 yaml 檔</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc get packagemanifests  prometheus-exporter-operator -o yaml
apiVersion: packages.operators.coreos.com/v1
kind: PackageManifest
metadata:
 creationTimestamp: <span style="color:#0086d2">&#34;2020-06-20T07:23:23Z&#34;</span>
 labels:
   catalog: community-operators
   catalog-namespace: openshift-marketplace
   olm-visibility: hidden
   openshift-marketplace: <span style="color:#0086d2">&#34;true&#34;</span>
   operatorframework.io/arch.amd64: supported
   operatorframework.io/os.linux: supported
   opsrc-datastore: <span style="color:#0086d2">&#34;true&#34;</span>
   opsrc-owner-name: community-operators
   opsrc-owner-namespace: openshift-marketplace
   opsrc-provider: community
   provider: Red Hat
   provider-url: <span style="color:#0086d2">&#34;&#34;</span>
 name: prometheus-exporter-operator
 namespace: default
 selfLink: /apis/packages.operators.coreos.com/v1/namespaces/default/packagemanifests/prometheus-exporter-operator
spec: {}
status:
 catalogSource: community-operators
 catalogSourceDisplayName: Community Operators
 catalogSourceNamespace: openshift-marketplace
 catalogSourcePublisher: Red Hat
 channels:
 - currentCSV: prometheus-exporter-operator.v0.2.0
   currentCSVDesc:
     annotations:
       alm-examples: |-
         [
           {
             <span style="color:#0086d2">&#34;apiVersion&#34;</span>: <span style="color:#0086d2">&#34;monitoring.3scale.net/v1alpha1&#34;</span>,
             <span style="color:#0086d2">&#34;kind&#34;</span>: <span style="color:#0086d2">&#34;PrometheusExporter&#34;</span>,
             <span style="color:#0086d2">&#34;metadata&#34;</span>: {
               <span style="color:#0086d2">&#34;name&#34;</span>: <span style="color:#0086d2">&#34;example-memcached&#34;</span>
             },
             <span style="color:#0086d2">&#34;spec&#34;</span>: {
               <span style="color:#0086d2">&#34;dbHost&#34;</span>: <span style="color:#0086d2">&#34;your-memcached-host&#34;</span>,
               <span style="color:#0086d2">&#34;dbPort&#34;</span>: 11211,
               <span style="color:#0086d2">&#34;grafanaDashboard&#34;</span>: {
                 <span style="color:#0086d2">&#34;label&#34;</span>: {
                   <span style="color:#0086d2">&#34;key&#34;</span>: <span style="color:#0086d2">&#34;autodiscovery&#34;</span>,
                   <span style="color:#0086d2">&#34;value&#34;</span>: <span style="color:#0086d2">&#34;enabled&#34;</span>
                 }
               },
               <span style="color:#0086d2">&#34;type&#34;</span>: <span style="color:#0086d2">&#34;memcached&#34;</span>
             }
           }
         ]
       capabilities: Deep Insights
       categories: Monitoring
       certified: <span style="color:#0086d2">&#34;false&#34;</span>
       containerImage: quay.io/3scale/prometheus-exporter-operator:v0.2.0
       createdAt: <span style="color:#0086d2">&#34;2020-06-08 00:00:00&#34;</span>
       description: Operator to setup 3rd party prometheus exporters, with a collection
         of grafana dashboards
       repository: https://github.com/3scale/prometheus-exporter-operator
       support: Red Hat, Inc.
     apiservicedefinitions: {}
     customresourcedefinitions:
       owned:
       - description: Configures a prometheus exporter to monitor a memcached instance
         displayName: PrometheusExporter
         kind: PrometheusExporter
         name: prometheusexporters.monitoring.3scale.net
         version: v1alpha1
     description: |
       A Kubernetes Operator based on the Operator SDK to centralize the setup of 3rd party prometheus exporters on **Kubernetes/OpenShift**, with a collection of grafana dashboards.

       You can setup different prometheus exporters to monitor the internals from different databases, or even any available cloudwatch metric from any AWS Service, by just providing a few parameters like **dbHost** or **dbPort** (operator manages the container image, port, argument, command, volumes... and also prometheus **ServiceMonitor** and **GrafanaDashboard** k8s objects).

       Current prometheus exporters types supported, managed by same prometheus-exporter-operator:
       * memcached
       * redis
       * mysql
       * postgresql
       * sphinx
       * es (elasticsearch)
       * cloudwatch

       The operator manages the lifecycle of the following objects:
       * Deployment (one per CR)
       * Service (one per CR)
       * ServiceMonitor (optional, one per CR)
       * GrafanaDashboard (optional, one per Namespace)

       <span style="color:#080;background-color:#0f140f;font-style:italic">### Documentation</span>
       Documentation can be found on our [website](https://github.com/3scale/prometheus-exporter-operator#documentation).

       <span style="color:#080;background-color:#0f140f;font-style:italic">### Getting help</span>
       If you encounter any issues <span style="color:#fb660a;font-weight:bold">while</span> using operator, you can create an issue on our [website](https://github.com/3scale/prometheus-exporter-operator) <span style="color:#fb660a;font-weight:bold">for</span> bugs, enhancements, or other requests.

       <span style="color:#080;background-color:#0f140f;font-style:italic">### Contributing</span>
       You can contribute by:
       * Raising any issues you find using Prometheus Exporter Operator
       * Fixing issues by opening [Pull Requests](https://github.com/3scale/prometheus-exporter-operator/pulls)
       * Submitting a patch or opening a PR
       * Improving [documentation](https://github.com/3scale/prometheus-exporter-operator)
       * Talking about Prometheus Exporter Operator
       All bugs, tasks or enhancements are tracked as [GitHub issues](https://github.com/3scale/prometheus-exporter-operator/issues).

       <span style="color:#080;background-color:#0f140f;font-style:italic">### License</span>
       Prometheus Exporter Operator is licensed under the [Apache 2.0 license](https://github.com/3scale/prometheus-exporter-operator/blob/master/LICENSE)
     displayName: Prometheus Exporter Operator
     installModes:
     - supported: true
       type: OwnNamespace
     - supported: true
       type: SingleNamespace
     - supported: false
       type: MultiNamespace
     - supported: true
       type: AllNamespaces
     provider:
       name: Red Hat
     version: 0.2.0
   name: alpha
 defaultChannel: alpha
 packageName: prometheus-exporter-operator
 provider:
   name: Red Hat 
</code></pre></div><p>裡面的內容很多看起來心煩意亂的，不過我們真正要關心的只有以下四點。</p>
<ul>
<li>name: prometheus-exporter-operator</li>
<li>defaultChannel: alpha</li>
<li>catalogSource: community-operators</li>
<li>catalogSourceNamespace: openshift-marketplace</li>
</ul>
<p>有這幾個參數就可以告訴<code>olm</code>說我們要用的是哪個<code>catalogsources</code>以及是哪一個<code>packagemanifests</code>。
從<code>defaultChannel</code> 我們可以看到我們要用到是 <code>alpha</code> 版，alpha 對應到的是operator <code>prometheus-exporter-operator.v0.2.0</code> 版。</p>
<p>進入這個 CRD <code>Subscription</code> 的重頭戲，宣告我要用哪一個<code>catalogsources</code>以及是哪一個<code>packagemanifests</code>。</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">cat<span style="color:#888"> </span>&lt;&lt;<span style="color:#888"> </span>EOF<span style="color:#888"> </span>|<span style="color:#888"> </span>oc<span style="color:#888"> </span>apply<span style="color:#888"> </span>-f<span style="color:#888"> </span>-<span style="color:#888">
</span><span style="color:#888"></span><span style="color:#fb660a;font-weight:bold">apiVersion</span>:<span style="color:#888"> </span>operators.coreos.com/v1alpha1<span style="color:#888">
</span><span style="color:#888"></span><span style="color:#fb660a;font-weight:bold">kind</span>:<span style="color:#888"> </span>Subscription<span style="color:#888">
</span><span style="color:#888"></span><span style="color:#fb660a;font-weight:bold">metadata</span>:<span style="color:#888">
</span><span style="color:#888">  </span><span style="color:#fb660a;font-weight:bold">name</span>:<span style="color:#888"> </span>prometheus-exporter-operator<span style="color:#888">
</span><span style="color:#888">  </span><span style="color:#fb660a;font-weight:bold">namespace</span>:<span style="color:#888"> </span>playolm<span style="color:#888">
</span><span style="color:#888"></span><span style="color:#fb660a;font-weight:bold">spec</span>:<span style="color:#888">
</span><span style="color:#888">  </span><span style="color:#fb660a;font-weight:bold">channel</span>:<span style="color:#888"> </span>alpha<span style="color:#888">
</span><span style="color:#888">  </span><span style="color:#fb660a;font-weight:bold">installPlanApproval</span>:<span style="color:#888"> </span>Manual<span style="color:#888">
</span><span style="color:#888">  </span><span style="color:#fb660a;font-weight:bold">name</span>:<span style="color:#888"> </span>prometheus-exporter-operator<span style="color:#888">
</span><span style="color:#888">  </span><span style="color:#fb660a;font-weight:bold">source</span>:<span style="color:#888"> </span>community-operators<span style="color:#888">
</span><span style="color:#888">  </span><span style="color:#fb660a;font-weight:bold">sourceNamespace</span>:<span style="color:#888"> </span>openshift-marketplace<span style="color:#888">
</span><span style="color:#888">  </span><span style="color:#fb660a;font-weight:bold">installPlanApproval</span>:<span style="color:#888"> </span>Manual<span style="color:#888">  
</span><span style="color:#888"></span>EOF<span style="color:#888">
</span><span style="color:#888"></span>subscription.operators.coreos.com/prometheus-exporter-operator<span style="color:#888"> </span>created<span style="color:#888">
</span></code></pre></div><p>這時候可以透過指令看看這個project訂閱了哪些<code>subscription</code>。</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ oc get subscription
NAME                           PACKAGE                        SOURCE                CHANNEL
prometheus-exporter-operator   prometheus-exporter-operator   community-operators   alpha
</code></pre></div><p>這邊的 <code>subscription</code> 可以把它當成 如果<code>packagemanifests</code> 有更新我們會收到更新的概念，說白了就是你訂閱youtuber有開啟小鈴鐺他就會通知你xD。</p>
<h2 id="crd---installplan">CRD - Installplan</h2>
<p>可以透過另外一個CRD看到目前 <code>project</code> 底下有訂閱（安裝？ 抱歉找不到一個適當的中文）哪些 Operator 他的版本是多少，現在安裝了嗎等資訊。</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc get installplan
NAME            CSV                                   APPROVAL   APPROVED
install-b5tmz   prometheus-exporter-operator.v0.2.0   Manual     false
</code></pre></div><p>從上署指令的結果來看這個 <code>project</code> 訂閱了<code>prometheus-exporter-operator.v0.2.0</code> 現在還沒有被 approved 所以還沒安裝到環境中。</p>
<p>現在我們要手動上一個 patch 讓這個安裝包被 approved ，再來觀察環境的變化。</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc patch installplan install-b5tmz --type=<span style="color:#0086d2">&#39;json&#39;</span> -p <span style="color:#0086d2">&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/approved&#34;, &#34;value&#34;:true}]&#39;</span>
installplan.operators.coreos.com/install-b5tmz patched
</code></pre></div><p>再透過指令看現在<code>prometheus-exporter-operator.v0.2.0</code>是否被approved了。</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc get installplan
NAME            CSV                                   APPROVAL   APPROVED
install-b5tmz   prometheus-exporter-operator.v0.2.0   Manual     true
</code></pre></div><h2 id="crd---clusterserviceversion-csv">CRD - ClusterServiceVersion (CSV)</h2>
<p>可以透過 <code>ClusterServiceVersion</code> 觀察目前在 cluster 執行的 Operator 是哪一個版本，以及有哪些 operator 正在執行。
:::warning
這邊要注意，只有被approved了的installplan才會被clusterserviceversion紀錄。
:::</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc get clusterserviceversion
NAME                                  DISPLAY                        VERSION   REPLACES   PHASE
prometheus-exporter-operator.v0.2.0   Prometheus Exporter Operator   0.2.0                Succeeded
</code></pre></div><p>看起來都有成功在執行，現在可以觀察 Kubernetes Cluster 裡面是否有安裝 <code>prometheus</code> 的相關元件。</p>
<p>觀察prometheus CRD有沒有成功安裝</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc get crd | grep prometheus
prometheuses.monitoring.coreos.com                          2020-06-20T07:24:12Z
prometheusexporters.monitoring.3scale.net                   2020-07-24T03:20:46Z
prometheusrules.monitoring.coreos.com                       2020-06-20T07:24:13Z
</code></pre></div><p>觀察 Prometheus CRD有沒有成功安裝</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc get crd | grep prometheus
prometheuses.monitoring.coreos.com                          2020-06-20T07:24:12Z
prometheusexporters.monitoring.3scale.net                   2020-07-24T03:20:46Z
prometheusrules.monitoring.coreos.com                       2020-06-20T07:24:13Z
</code></pre></div><p>觀察 Prometheus ServiceAccount 有沒有成功安裝</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc get sa | grep prometheus
prometheus-exporter-operator   <span style="color:#0086f7;font-weight:bold">2</span>         7m45s
</code></pre></div><p>觀察 Prometheus role rolebinding 有沒有成功安裝</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc get role,rolebinding | grep prometheus
role.rbac.authorization.k8s.io/prometheus-exporter-operator.v0.2.0-2nb8s   8m40s
rolebinding.rbac.authorization.k8s.io/prometheus-exporter-operator.v0.2.0-2nb8s-prometheus-exporfkbqh   8m40s
</code></pre></div><p>最後看看 Prometheus Operator 有沒有成功安裝到 Kubernetes 上</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">oc get deployments
NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
prometheus-exporter-operator   1/1     1            1           9m38s
</code></pre></div><p>看起來一切都很正常，但魔鬼藏在細節裡是不是 prometheus-exporter-operator Deployment版本如我們預期的一樣</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc get deployment prometheus-exporter-operator -o go-template --template <span style="color:#0086d2">&#39;{{range .spec.template.spec.containers}} {{.image}}{{end}}&#39;</span>
 quay.io/3scale/prometheus-exporter-operator:v0.2.0
</code></pre></div><p>從上述輸出的結果來看版本跟 <code>packagemanifests</code> 所定義的是一樣的。</p>
<h2 id="結語">結語</h2>
<p>雖然感覺得出來 RedHat 立意良好，但是操作那麼多 CRD 情況真的有點麻煩，另外我在測試這幾個 CRD 的時候發現當刪除 <code>ClusterServiceVersion</code> 的時候，Operator的相關資源都會被刪除，感覺這個邏輯不怎麼正確。</p>
<p>我個人覺得是不是 <code>installplan</code> 刪除或是 DISAPPROVED 才會刪除 <code>ClusterServiceVersion</code> ，使用者就算 <code>誤刪</code> 了也應該偵測到這件事情並重新生成一個 <code>ClusterServiceVersion</code> 才對。</p>
<p>以上純屬個人見解，希望能與大家討論交流。</p>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/openshift/" rel="tag">openshift</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Meng Ze avatar" src="/img/apple.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Meng Ze</span>
	</div>
	<div class="authorbox__description">
		Meng 專注於雲端世界的耕耘者，喜歡潛水健身等休閒運動。
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/post/ocp/operator-lifecycle-manager-1/" rel="prev">
			<span class="post-nav__caption">«&thinsp;Previous</span>
			<p class="post-nav__post-title">簡單理解 Operator Lifecycle Manager - 1 (OLM)</p>
		</a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/post/ocp/cluster-monitoring-operator/" rel="next">
			<span class="post-nav__caption">Next&thinsp;»</span>
			<p class="post-nav__post-title">Cluster Monitoring Operator</p>
		</a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "meng-ze" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Meng Ze&#39;s Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>